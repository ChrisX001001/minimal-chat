<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0,user-scalable=0" />
    <meta name="robots" content="index, follow">
    <meta name="author" content="Tanner Middleton">
    <meta name="description" content="An open source minimal GPT/DALL-E/PaLM chat web application.">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <link rel="stylesheet" href="styles/site.css">
    <link rel="manifest" href="manifest.webmanifest" />
    <title>MinimalGPT</title>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R42YRRG1Y1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-R42YRRG1Y1');
</script>


<body class="app-body">
    <div id="fileUploadDiv">
        <input type="file" id="fileUpload" style="display: none;" data-bind="event: { change: uploadFile }">
        <div data-bind="click: openFileSelector" style="display: none;">Upload File</div>
    </div>
    <div class="app-container" id="app-container">
        <div class="sidebar box" id="settings-dialog" data-bind="css: { open: isSidebarOpen }">
            <!-- Add settings content here -->
            <div class="settings-header">
                <h2 data-bind="click: () => { window.location.reload(true); }">
                    <span class="fa-solid fa-arrows-rotate"></span>
                    Settings | V3.2.4</h2>
            </div>
            <div class="sidebar-content-container">
                <div class="api-key">
                    <label for="api-key">GPT Key:</label>
                    <input autocomplete="off" id="api-key" placeholder="Enter your API Key...">
                </div>
                <div class="slider-container">
                    <span>Serious</span>
                    <input type="range" min="0" max="200" data-bind="value: sliderValue">
                    <span>Creative</span>
                </div>
                <div class="control">
                    <label for="model-selector">DALL-E Image Count:</label>
                    <select id="model-selector" data-bind="value: selectedDallEImageCount">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
            
                    </select>
                </div>
                <div class="control">
                    <label for="model-selector">DALL-E Image Resolution:</label>
                    <select id="model-selector" data-bind="value: selectedDallEImageResolution">
                        <option value="256x256">256x256</option>
                        <option value="512x512">512x512</option>
                        <option value="1024x1024">1024x1024</option>
                    </select>
                </div>
                <div class="api-key">
                    <label for="api-key">PaLM Key:</label>
                    <input id="palm-api-key" autocomplete="off" placeholder="Enter your API Key...">
                </div>
                <div class="slider-container">
                    <span>Serious</span>
                    <input type="range" min="0" max="100" data-bind="value: palmSliderValue">
                    <span>Creative</span>
                </div>
                <div class="control">
                    <label for="model-selector">Auto Save Conversations:</label>
                    <select id="model-selector" data-bind="value: selectedAutoSaveOption">
                        <option value="true">Yes</option>
                        <option value="false">No</option>
                    </select>
                </div>
                <div class="control">
                    <label for="model-selector">Model:</label>
                    <select id="model-selector" data-bind="value: selectedModel">
                        <option value="gpt-3.5-turbo">GPT-3.5-turbo</option>
                        <option value="gpt-4">GPT-4</option>
                        <option value="chat-bison-001">PaLM</option>
                    </select>
                </div>
            </div>
            <div>
                <button class="close-btn" data-bind="click: toggleSidebar">Close</button>
            </div>
        </div>
        <div class="sidebar box" id="settings-dialog" data-bind="css: { open: showConversationOptions }">
            <!-- Add conversations content here -->
            <div class="settings-header">
                <h2>Conversations</h2>
            </div>
            <div class="sidebar-content-container">
                <div class="scrollable-list">
                    <ul data-bind="foreach: displayConversations">
                        <li data-bind="text: $data.conversation.title, click: $parent.loadSelectedConversation"></li>
                    </ul>
                </div>
            </div>
            <div class="import-export-container">
                <button class="import-export-btn" data-bind="click: () => { clearMessages(); showConversationOptions(false); }">New</button>
                <button class="import-export-btn" data-bind="click: importConversationsClick">Import</button>
                <button class="import-export-btn" data-bind="click: exportConversationsClick">Export</button>
            </div>
            <div>
                <button class="close-btn" data-bind="click: () => showConversationOptions(false)">Close</button>
            </div>
        </div>
        <div class="chat-container">
            <div class="container">
                <div class="chat">
                    <div class="header box">
                        <a href="https://github.com/TannerMiddleton/minimal-gpt#try-minimalgpt" target="_blank"
                            class="no-style-link"
                            data-bind="text: selectedModel().indexOf('bison') !== -1 ? 'MinimalPaLM' : 'MinimalGPT'">
                        </a>
                        <a href="https://github.com/TannerMiddleton/minimal-gpt#try-minimalgpt" target="_blank"
                        class="no-style-link">
                            <span class="fa-brands fa-github"></span>
                        </a>

                        <div class="settings-btn fa-solid fa-sliders fa-xl" data-bind="click: toggleSidebar"></div>
                        <div class="trash-btn fa-regular fa-trash-can fa-xl"
                            data-bind="click: deleteCurrentConversation">
                        </div>
                        <div class="conversations-count">
                            <div class="general-processing" data-bind="visible: isProcessing">
                                <span class="loading spinner"></span>
                            </div>
                            <span class="save-icon fa-regular fa-floppy-disk fa-xl"
                                data-bind="click: clearMessages"></span>
                            <span class="count-icon fa-xl fa-solid"
                                data-bind="css: storedConversations().length > 0 ? 'fa-' + storedConversations().length : 'fa-0'"></span>
                            <div class="saved-conversations-dropdown fa-regular fa-comments fa-xl"
                                data-bind="click: onShowConversationsClick"></div>
                        </div>
                    </div>
                    <div class="messages" id="messagesContainer">
                        <div class="floating-button" data-bind="visible: messages().length > 2, click: showSearchField, stopClickPropagation: {}">
                            <span class="fa-solid fa-magnifying-glass fa-xl"></span>
                        </div>
                        <div class="floating-search-field" id="floating-search-field"
                            data-bind="css: showingSearchField() ? 'show' : ''">
                            <textarea id="user-search-input" class="search-input-text" rows="1" placeholder=""
                                data-bind="textInput: userSearchInput"></textarea>
                        </div>
                        <!-- ko foreach: filteredMessages -->
                        <div 
                            data-bind="visible: $parent.userSearchInput().trim().length > 0, css: role === 'user' ? 'user message' : 'gpt message', attr: { 'data-role': role }">
                            <span class="label" data-bind="text: role === 'user' ? 'Me' : 'GPT'"></span>
                            <span id="message-contents"   data-bind="html: $parent.formatMessage(content, false)"></span>
                        </div>
                        <!-- /ko -->


                        <!-- ko ifnot: selectedModel().indexOf('bison') !== -1 -->
                        <!-- ko foreach: messages()-->
                        <!-- ko if:  $parent.userSearchInput().trim().length === 0-->
                        
                        <div  
                            data-bind="css: role === 'user' ? 'user message' : 'gpt message', attr: { 'data-role': role }">
                            <div class="label">
                                <span class="fa-solid fa-robot icon" data-bind="visible: role !== 'user'"></span>
                                <span class="fa-solid fa-circle-user icon" data-bind="visible: role === 'user'"></span>
                                <span data-bind="text: (role === 'user' ? 'User' : (role !== 'user' && $index() > 0 && $parent.messages()[$index() - 1].content.toLowerCase().startsWith('image::')) ? 'DALL-E' : 'GPT')"></span>
                            </div>
                            <!-- <div class="copy-text">
                                            <button data-bind="click: () => { $parent.copyText(content); }">Copy</button>
                                        </div> -->
                            <span id="message-contents"  data-bind="html: $parent.formatMessage(content, false)"></span>
                        </div>
                        <!-- /ko -->
                        <!-- /ko -->
                        <!-- /ko -->

                        <!-- ko if: selectedModel().indexOf('bison') !== -1 -->
                        <!-- ko foreach: messages() -->
                        <!-- ko if:  $parent.userSearchInput().trim().length === 0 -->
                        <div  
                            data-bind="css: role === 'user' ? 'user message' : 'gpt message', attr: { 'data-role': role }">
                            <span class="label" data-bind="text: role === 'user' ? 'User' : 'PaLM'"></span>
                            <span  id="message-contents" data-bind="html: $parent.formatMessage(content, false)"></span>
                        </div>
                        <!-- /ko -->
                        <!-- /ko -->
                        <!-- /ko -->

                        <!-- ko if: isLoading() && !isPalmEnabled() -->
                        <div class="gpt message padded" >
                            <div class="label">
                                <span class="fa-solid fa-robot icon"></span>
                                <span>GPT</span>
                            </div>
                            <span  data-bind="html: formatMessage(streamedMessageText() || ''), false"></span>
                        </div>
                        <!-- /ko -->

                        <!-- ko if: isLoading() && isPalmEnabled() -->
                        <div class="gpt message padded" > 
                            <span class="label">PaLM</span>
                            <span data-bind="text: 'Generating response '"></span>
                            <span class="loading spinner"></span>
                        </div>
                        <!-- /ko -->

                        <!-- ko if: isGeneratingImage -->
                        <div class="gpt message padded">
                            <span class="label">DALL-E</span>
                            <span data-bind="text: 'Generating Image, this might take a minute.'"></span><span
                                class="loading spinner"></span>
                        </div>
                        <!-- /ko -->

                        <div class="floating-button scroll" id="scroll-button"
                            data-bind="click: scrollToBottom(), css: shouldShowScrollButton() === true ? 'show' : ''">
                            <span class="fa-solid fa-circle-chevron-down fa-xl"></span>
                        </div>
                    </div>

                    <form id="chat-form" data-bind="submit: sendMessage, event: { 'swiped-left': swipedLeft, 'swiped-right': swipedRight }" data-swipe-threshold="15" data-swipe-unit="vw" data-swipe-timeout="250">
                        <textarea id="user-input" class="user-input-text" rows="1" placeholder=""
                            data-bind="textInput: userInput"></textarea>
                        <span data-bind="visible: isLoading" class="loading input-spinner"></span>
                        <div class="send-button box" data-bind="click: sendMessage">
                            <span class="fa-regular fa-message fa-xl"></span>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <script async src="https://cdn.jsdelivr.net/npm/pwacompat" crossorigin="anonymous"></script>
    <script type="module" src="index.js"></script>
    <script type="module" src="js/app-view-model.js"></script>
    <script type="module" src="js/storage.js"></script>
    <script type="module" src="js/utils.js"></script>
    <script type="module" src="js/palm-api-access.js" type="module"></script>
    <script src="https://cdn.jsdelivr.net/npm/markdown-it/dist/markdown-it.min.js"></script>
    <script src="https://unpkg.com/hotkeys-js/dist/hotkeys.min.js"></script>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
</body>

</html>